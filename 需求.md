# stanford_tidybot 机器人控制与监控 App 需求文档（纯血鸿蒙版）

本 App 基于**纯血鸿蒙系统 API20** 开发，采用 ArkTS 声明式开发范式，仅实现 **stanford_tidybot 机器人（Mujoco XML 仿真环境）的核心控制与实时监控** 能力，新增标准化通讯协议及语音识别控制功能，无账号体系、个性化设置等附加功能。聚焦「监控数据展示 - 机器人控制（手动 + 语音）- 仿真状态反馈」核心流程，界面遵循鸿蒙原生设计语言，兼顾简洁美观与功能完整性，适配鸿蒙 API20 主流纯血设备。

## 一、核心监控功能

1. 实时仿真数据展示

   - 提供 **简洁美观的极简数据监控面板**，遵循鸿蒙原生视觉风格（圆角控件、柔和配色），支持展示 stanford_tidybot 机器人核心仿真数据，包括：关节角度 / 转速、末端执行器坐标（x/y/z）、机器人姿态（俯仰 / 横滚）、Mujoco 仿真帧率（FPS），数据实时刷新无延迟（延迟≤1 秒）。
   - 数据展示支持 **自动换行、固定排版**，适配 API20 设备不同屏幕尺寸，无数据重叠、排版错乱；关键异常数据（如超出合理范围的关节角度）采用浅红底色 + 加粗字体高亮标注，无需复杂图表。
   - 数据加载 / 刷新过程中，显示鸿蒙原生风格的 **简易加载动效**（“正在获取仿真数据...” 文字 + 环形加载动画）；无仿真数据返回时，展示占位提示（“暂无监控数据，请启动仿真”），占位样式与整体界面风格统一。

   

2. 机器人状态可视化（极简美观版）

   - 接收 Mujoco 仿真环境返回的机器人状态信息，**实时展示机器人当前工作模式**（停止 / 运动 / 待机），以 “极简图标 + 文字” 形式呈现（停止 = 灰色静态方块、运动 = 绿色呼吸式圆点、待机 = 蓝色空心圆），图标风格贴合鸿蒙设计规范。
   - 支持展示 **极简仿真环境状态**（仿真是否启动 / 暂停、仿真时间戳），仅保留核心状态文本反馈，状态文本与图标横向居中排布，视觉层次清晰。
   - 监控面板支持 **流畅上下滑动** 查看更多数据（若核心数据超过一屏），滑动无卡顿，数据刷新与滑动操作无冲突，滑动阻尼适配 API20 触控特性。阻尼适配 API20 触控特性。

   

3. 监控交互反馈

   - 仿真环境通过通讯协议连接成功后，立即刷新监控面板数据，同时在标题栏下方展示 “仿真已连接” 的轻量级提示（鸿蒙原生 Toast 样式），避免用户误操作。
   - 仿真连接异常 / 数据获取失败时，弹出 **明确的鸿蒙风格错误提示框**（“仿真环境连接失败，请检查仿真服务是否启动”），并提供 “重新连接” 按钮（按钮样式统一为鸿蒙原生圆角按钮）。
   - 监控面板右上角配置鸿蒙原生风格的 “刷新” 图标按钮（极简线条样式），点击后手动触发一次数据获取，适配高实时性场景。

   

## 二、通讯协议规范

### 1. 通讯基础

- 通讯方式：基于本地网络（TCP 协议）实现 App 与 Mujoco 仿真环境的双向交互，适配鸿蒙 API20 网络能力（仅申请本地网络访问权限）。
- 数据格式：统一采用 JSON 格式传输数据，字符编码为 UTF-8，保证跨端解析兼容性。
- 传输效率：单次数据传输大小≤1KB，指令 / 数据响应延迟≤2 秒，适配 Mujoco 仿真环境处理速度。

### 2. 协议字段定义

#### （1）监控数据上报（仿真环境→App）

json

```
{
  "type": "monitor_data",
  "timestamp": "HH:MM:SS", // 时间戳（小时:分钟:秒）
  "data": {
    "joint_angle": [0.1, 0.2, ...], // 关节角度数组
    "joint_speed": [10, 15, ...], // 关节转速数组
    "end_effector": {"x": 1.2, "y": 2.3, "z": 3.4}, // 末端执行器坐标
    "posture": {"pitch": 0.5, "roll": 0.3}, // 机器人姿态（俯仰/横滚）
    "fps": 60, // 仿真帧率
    "robot_status": "running" // 机器人状态：stop/running/standby
  },
  "status": "success" // 数据状态：success/error
}
```

#### （2）控制指令下发（App→仿真环境，含手动 / 语音指令）

json

```
{
  "type": "control_cmd",
  "timestamp": "HH:MM:SS",
  "cmd_type": "move_forward", // 指令类型：move_forward/move_back/turn_left/turn_right/grab/release/start_sim/pause_sim/stop_sim/adjust_param
  "param": {}, // 指令参数（如转速调节：{"speed": 50}），无参数则为空
  "source": "manual/voice", // 指令来源：手动/语音
  "request_id": "unique_id_001" // 指令唯一标识，用于校验重复/重试
}
```

#### （3）指令响应反馈（仿真环境→App）

json

```
{
  "type": "cmd_response",
  "request_id": "unique_id_001", // 对应下发指令的唯一标识
  "result": "success/fail", // 执行结果
  "msg": "指令执行完成/指令执行失败：仿真未启动", // 反馈信息
  "timestamp": "HH:MM:SS"
}
```

### 3. 协议容错与校验

- 指令唯一性校验：通过 `request_id` 禁止重复执行同一指令，避免指令堆积。
- 数据格式校验：仿真环境 / App 接收数据后，校验 JSON 格式及关键字段完整性，格式错误则返回 `status: error` 并提示 “数据格式异常”。
- 超时处理：指令下发后超过 10 秒未收到反馈，判定为超时，触发重试机制。

## 三、核心控制功能

### 1. 手动基础控制输入

- 提供 **简洁美观的极简控制操作区**，遵循鸿蒙 API20 控件规范，支持机器人核心动作控制：前进 / 后退 / 左转 / 右转（方向控制）、末端执行器抓取 / 释放（执行器控制）、仿真启动 / 暂停 / 停止（环境控制），采用 “图标 + 文字” 按钮式布局，按钮间距、大小适配触控交互。
- 控制按钮配置鸿蒙原生风格的 **文字 + 图标提示**（如前进 =“前进”+ 向上箭头），点击时有按压反馈（变色 + 轻微缩放，符合 API20 触控交互规范）。
- 支持 **控制指令校验**：禁止重复发送同一指令（通过 `request_id` 校验），对无效指令（如仿真未启动时发送 “前进”）弹出鸿蒙风格提示框并限制提交。
- 指令发送后，按钮短暂置灰（直至收到仿真反馈），防止频繁操作导致指令堆积。

### 2. 语音识别控制（新增）

- 语音唤醒：支持极简唤醒词 “tidybot” 唤醒语音控制功能，唤醒成功后展示 “麦克风已激活” 的轻量级提示（鸿蒙 Toast 样式），未唤醒时麦克风处于休眠状态。
- 语音指令识别：基于鸿蒙 API20 原生语音识别能力，支持核心控制指令的语音输入，包括：“前进”“后退”“左转”“右转”“抓取”“释放”“启动仿真”“暂停仿真”“停止仿真”。
- 语音指令处理：
  - 识别结果实时展示在 “语音指令预览区”（控制操作区顶部），支持手动确认 / 取消发送；
  - 对识别结果做指令有效性校验（如仿真未启动时识别到 “前进”，自动提示 “指令无效：仿真未启动”）；
  - 确认发送后，按通讯协议格式下发指令，指令来源标记为 “voice”。
- 语音交互反馈：
  - 语音识别成功：展示绿色文字 “语音识别成功：前进”；
  - 语音识别失败：展示红色文字 “语音识别失败，请重试”，并提供 “重新识别” 按钮；
  - 指令执行结果：同步在日志区展示（如 “[14:35] 语音指令：前进 - 执行完成”）。
- 语音权限：仅申请麦克风权限（用于语音识别），用户首次打开语音功能时弹窗申请，权限关闭时禁用语音控制并提示 “请开启麦克风权限以使用语音控制”。

### 3. 控制指令反馈

- 发送控制指令（手动 / 语音）后，立即将指令内容（含来源）展示在「操作日志区」（如 “[14:35] 语音指令：前进”），同时触发仿真数据刷新和状态更新。
- 指令执行成功 / 失败时，提供 **明确的鸿蒙风格反馈提示**（成功 = 绿色文字 “指令执行完成”、失败 = 红色文字 “指令执行失败，请重试”），失败时提供 “重新发送” 按钮。
- 支持 **单条指令重试**：针对失败的指令，可通过日志区条目旁的 “重试” 按钮单独重新发送，无需重复操作按钮组 / 语音识别。

### 4. 极简高级控制（可选）

- 提供 **简洁美观的参数调节输入框**（鸿蒙 API20 原生输入框样式），支持关节转速、抓取力度等数字型参数调节，输入框适配软键盘弹出 / 收起的布局自适应。
- 参数输入校验：禁止输入非数字内容、禁止输入超出合理范围的数值（如转速 0-100 区间），违规输入弹出鸿蒙风格提示并限制提交。

## 四、操作日志与界面布局

### 1. 操作日志展示

- 采用 **单列列表式布局**（鸿蒙原生 List 组件），展示所有控制指令（手动 / 语音）、执行结果、仿真状态变更记录，日志条目自适应文字长度，最大宽度限制为屏幕 90%，条目间距统一，视觉整洁。
- 每条日志附带 **极简时间戳**（小时：分钟），标注在日志条目右侧，字体颜色为浅灰色（#999999），不干扰核心信息阅读；不同类型日志（手动 / 语音 / 系统）采用细微颜色区分（手动 = 黑色、语音 = 蓝色、系统 = 灰色）。

### 2. 日志区基础操作

- 日志区支持 **流畅上下滑动** 翻页，查看历史操作日志，滑动阻尼适配 API20 特性，滑到顶部 / 底部时展示极简提示（如 “已到日志顶部”）。
- 新指令 / 反馈产生后，日志区自动滚动至底部，方便查看最新结果；滚动动画流畅，无卡顿。
- 支持 **长按单条日志** 弹出极简操作菜单（仅保留 “复制” 功能），菜单样式遵循鸿蒙 API20 弹窗规范。

### 3. 主页面（唯一核心页面）

- 页面仅保留极简标题栏（显示 “tidybot 仿真控制”），无侧边栏、底部 tab，整体风格简洁美观，符合鸿蒙原生设计语言。

- 页面布局（竖屏全屏，适配刘海屏 / 全面屏）：

  plaintext

  ```
  标题栏（占5%）→ 实时监控面板（占40%）→ 操作日志区（占25%）→ 控制操作区（占30%）
  ```

  

  控制操作区内部布局：语音唤醒按钮（顶部）→ 方向 / 核心控制按钮组（中部）→ 可选参数输入框（底部），控件间距、比例协调，视觉层次清晰。

- 适配鸿蒙 API20 特性：软键盘弹出时控制操作区自动上移，避免输入框被遮挡；软键盘收起后布局自动恢复，无错位。

### 4. 界面适配与交互

- 适配 API20 主流手机屏幕尺寸（375px-450px 宽度），控件采用弹性布局，无拉伸、变形问题；色彩方案遵循鸿蒙 “简约、自然” 原则（主色：鸿蒙蓝 #007DFF，辅助色：浅绿 #00C48C、浅红 #FF6B6B，中性色：白 #FFFFFF、灰 #F5F5F5、深灰 #333333）。
- 所有按钮、输入框、滑动控件均适配鸿蒙 API20 原生触控交互，无点击无响应、触控区域偏移问题。

## 五、基础性能与异常处理

### 1. 性能要求

- 启动性能：无启动页 / 闪屏、无广告，API20 设备上启动时间≤3 秒，打开即进入主页面并自动尝试连接仿真环境。
- 交互性能：监控数据刷新、指令发送 / 反馈、日志滑动、语音识别响应无明显卡顿；语音识别从唤醒到展示结果延迟≤1.5 秒，指令响应延迟≤2 秒。
- 存储性能：仅缓存当前会话的监控数据和操作日志，退出 App 后自动清空，无持久化存储，不占用多余设备存储。
- 通讯性能：TCP 连接稳定，无指令丢失、重复执行问题，弱网（本地网络）环境下自动触发重连机制。

### 2. 异常处理

- **仿真环境连接异常**：未连接到 Mujoco 仿真服务时，所有控制按钮（手动 + 语音）、参数输入框置灰，弹出鸿蒙风格提示 “请启动 Mujoco 仿真服务并检查连接”，仅保留 “重新连接” 功能。
- **语音识别异常**：麦克风权限未开启 / 识别超时 / 无语音输入时，展示对应提示（如 “麦克风权限未开启”“未检测到语音，请重试”），并引导用户解决问题。
- **网络 / 服务超时**：指令发送后超过 10 秒未收到反馈，弹出 “请求超时，请检查仿真服务状态并重试” 提示，提供重新发送选项。
- **无效反馈处理**：仿真环境返回空数据 / 无效格式数据时，监控面板展示 “数据异常，请刷新”，日志区记录 “收到无效仿真数据”。
- **App 前后台切换**：切后台（5 分钟内）保留监控数据、日志、仿真连接状态，切前台后自动刷新数据；后台超过 5 分钟则断开连接，切前台后提示 “请重新连接仿真环境”。
- **机器人异常状态处理**：监控到机器人关节角度 / 姿态超出合理范围时，对应数据高亮，弹出 “机器人状态异常，请停止操作” 提示，并自动发送 “停止” 指令至仿真环境。

## 六、非功能需求

1. **权限管控**：仅申请必要权限 —— 网络权限、本地网络访问权限、麦克风权限（语音识别），无相机、相册、定位等多余权限；麦克风权限仅在语音控制唤醒时激活，闲置时自动休眠。
2. **系统适配**：仅支持纯血鸿蒙 API20 及以上版本设备，遵循鸿蒙 App 开发最佳实践，无跨平台兼容层，保证运行流畅性。
3. **数据安全**：无数据上传云端，所有通讯数据仅在本地网络传输，保障数据隐私。
4. **界面规范**：仅支持简体中文界面，控件提示、反馈信息、语音指令均为中文，符合中文用户交互习惯。
5. **无冗余功能**：无账号体系、无推送通知、无广告 / 推广 / 评分弹窗，保持界面干净简洁。